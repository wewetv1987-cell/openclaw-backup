# HEARTBEAT.md

> 心跳任务：定期检查代理状态和任务进度

## 心跳规则

每次心跳时执行以下检查：

### 1. 检查任务队列
```
读取 tasks/QUEUE.md
- 检查 In Progress 中的任务是否有超时（>预期时间的2倍）
- 如有超时，标记为阻塞并通知用户
- 检查是否有 🔥 插队任务需要立即处理
```

### 2. 更新代理状态
```
检查各代理是否在执行任务
- 空闲 → 显示"✅ 空闲"
- 工作中 → 显示当前任务和进度
- 阻塞 → 显示阻塞原因
```

### 3. 生成进度报告
**重要**: 每完成一小段任务，必须主动输出进度报告。

如果用户询问"进度"、"状态"等，提供：
- 各代理当前状态
- 进行中的任务及进度
- 最近完成的任务
- 任何阻塞的任务
- **每完成一小段任务立即输出进度**（不等待用户询问）

## 🔥 实时进度规则（重要！）

### 进度报告频率
- **每个小步骤完成** → 立即输出进度
- **遇到问题** → 立即报告问题 + 当前状态
- **等待外部资源** → 说明在等什么，预计多久
- **长时间操作** → 每30秒输出一次状态

### 进度报告格式
```
📍 [任务名] - [当前步骤]
✅ 已完成: [完成的子任务]
🔄 进行中: [正在做的事]
⏳ 待处理: [接下来要做的]
⚠️ 问题: [如有问题说明]
```

### 问题诊断规则
遇到卡住超过2分钟的任务：
1. 立即报告当前位置
2. 说明可能的原因
3. 提供解决方案选项
4. 等待用户指示

## 🔥 优先级插队系统

### 优先级级别
| 级别 | 标记 | 说明 |
|------|------|------|
| 🔥 紧急 | `🔥` | 用户直接指定，立即打断当前任务 |
| ⭐ 高 | `⭐` | 重要任务，优先于普通任务 |
| 普通 | 无标记 | 按顺序执行 |
| ⏸️ 暂停 | `⏸️` | 暂停执行，等待条件 |

### 插队规则
1. **用户新发布的任务 = 🔥 紧急**
   - 即使用户没有明说，新任务默认可插队
   - 如果正在执行其他任务，询问用户是否插队

2. **插队执行流程**
   ```
   1. 暂停当前任务 → 标记 ⏸️
   2. 执行插队任务 → 标记 🔥
   3. 完成后恢复 → 继续原任务
   ```

3. **用户可随时说**
   - "先做这个" → 插队
   - "等等，改一下" → 修改当前任务
   - "停下" → 暂停所有

## 🌐 自主问题解决

### 遇到问题时自动执行
```
1. 技能缺失 → 搜索并安装
   - clawhub search [关键词]
   - https://clawhub.ai
   - https://github.com/VoltAgent/awesome-openclaw-skills

2. 知识盲区 → 联网学习
   - Tavily Search
   - web_fetch
   - MCP web-reader

3. 错误诊断 → 搜索解决方案
   - 搜索错误信息
   - 尝试解决方案
   - 记录有效方案
```

## 心跳频率

- 默认: 每5分钟
- 有进行中任务时: 每1分钟
- 用户明确要求时: 立即

## 🎯 空闲时自动学习

**重要**: 当检测到没有任务时，自动执行学习！

### 空闲检测
```
条件:
- 任务队列为空
- 没有进行中的子代理
- 没有用户消息待处理

动作:
→ 自动开始学习
```

### 学习选择策略
```
优先级:
1. 检查 LEARNING_SYSTEM.md 的学习目标
2. 轮流选择领域: 金融 → 编程 → 逆向 → 金融...
3. 优先学习进度最低的领域

学习方式:
- Tavily 搜索相关教程
- web_fetch 抓取技术文章
- 总结并写入 memory/knowledge/
```

### 学习流程
```
1. 选择主题 (基于进度和轮换)
2. 搜索学习资源
3. 阅读并总结
4. 写入知识库
5. 更新学习进度
6. 生成学习报告 (可选通知用户)
```

## 使用方式

用户可以随时问：
- "进度怎么样"
- "状态"
- "任务列表"
- "谁在做什么"
- "先做这个" ← 插队
- "等等" ← 暂停

---
*最后更新: 2026-02-17 00:57*
