# TEAM_ORCHESTRATION.md - 多代理团队编排配置

> 优化版 v3 - 2026-02-17 13:55 GMT+7
> 修正：GLM-5是最强模型，GLM-4.7-Flash仅2并发用于灾难处理

---

## 🎯 模型资源

### 主力模型
| 模型 | 并发 | 特点 | 分配代理 |
|------|------|------|---------|
| **GLM-5** | 5 | **最新最强** | Architect, **Coder**, Researcher, Reviewer |
| **GLM-4.6V** | 20 | 视觉+分析 | Analyst |
| **GLM-4.5** | 20 | 快速响应 | Main, Automator |

### 特殊模型
| 模型 | 特点 | 用途 |
|------|------|------|
| **GLM-4-Long** | 1M上下文 | 按需调用 - 超长文本处理 |
| **GLM-4-FlashX** | 16K输出 | 按需调用 - 长输出任务 |

### 备用模型
| 模型 | 并发 | 特点 | 用途 |
|------|------|------|------|
| **GLM-4.7-Flash** | 2 | 免费/低并发 | 灾难处理/降级备用 |

---

## 🎭 角色分配

### GLM-5 阵营 (复杂任务专精) - 5并发共享 (4代理)

#### Architect (架构师)
- **模型**: GLM-5 (最新最强)
- **并发**: 5并发池 (4代理共享)
- **角色**: Builder + Spec Writer
- **专长**: 复杂系统设计、技术决策、规范编写
- **输出**: `/shared/specs/`, `/shared/decisions/`
- **为什么GLM-5**: 架构设计需要最强推理能力

#### Coder (编程)
- **模型**: GLM-5 (最新最强)
- **并发**: 5并发池 (4代理共享)
- **角色**: Builder
- **专长**: 高质量代码生成、Bug修复、测试编写
- **输出**: `/shared/artifacts/code/`
- **为什么GLM-5**: 代码质量需要最强推理能力！

#### Researcher (研究员)
- **模型**: GLM-5 (最新最强)
- **并发**: 5并发池 (4代理共享)
- **角色**: Researcher
- **专长**: 深度技术调研、复杂信息整理、知识提取
- **输出**: `/shared/specs/research/`
- **为什么GLM-5**: 深度调研需要最强推理能力

#### Reviewer (审查者)
- **代理**: Architect兼任
- **模型**: GLM-5 (最新最强)
- **并发**: 5并发池 (4代理共享)
- **职责**: 审查代码、架构、文档
- **为什么GLM-5**: 审查需要最强推理能力

---

### GLM-4.6V 阵营 (视觉专精) - 20并发

#### Analyst (分析师)
- **模型**: GLM-4.6V (视觉+分析)
- **并发**: 20并发
- **角色**: Analyst
- **专长**: 金融分析、数据解读、图表分析、视觉内容处理
- **输出**: `/shared/artifacts/analysis/`
- **为什么GLM-4.6V**: 图表分析需要视觉能力

---

### GLM-4.5 阵营 (快速响应) - 20并发

#### Main (协调者)
- **模型**: GLM-4.5 (快速响应)
- **并发**: 20并发
- **职责**: 路由任务、跟踪状态、优先级决策、报告进度
- **边界**: 不执行复杂工作，只协调
- **为什么GLM-4.5**: 协调需要快速响应

#### Automator (自动化)
- **模型**: GLM-4.5 (快速响应)
- **并发**: 20并发
- **角色**: Ops
- **专长**: Cron任务、脚本、模板工作、批量操作
- **输出**: `/shared/artifacts/scripts/`
- **为什么GLM-4.5**: 脚本生成需要快速响应

---

## 🎯 任务路由规则

### 按复杂度分配

| 任务类型 | 分配代理 | 模型 | 原因 |
|---------|---------|------|------|
| 复杂架构设计 | Architect | GLM-5 | 需要最强推理 |
| **代码生成** | **Coder** | **GLM-5** | **代码质量需要最强推理！** |
| 深度技术调研 | Researcher | GLM-5 | 需要最强推理 |
| 代码审查 | Reviewer | GLM-5 | 需要最强推理 |
| 图表分析 | Analyst | GLM-4.6V | 需要视觉能力 |
| 脚本编写 | Automator | GLM-4.5 | 简单任务 |
| 任务路由 | Main | GLM-4.5 | 快速响应 |

---

## 🔧 特殊模型调用

### GLM-4-Long (1M上下文)
```
触发条件:
- 需要处理超长文本 (>100K token)
- 需要分析整个代码库
- 需要跨文档关联分析
- 需要长期记忆检索

调用方式:
1. Main 识别任务需求
2. 将任务路由给 Researcher
3. Researcher 使用 GLM-4-Long 处理
```

### GLM-4-FlashX (16K输出)
```
触发条件:
- 需要生成长文档 (>4K token输出)
- 需要完整设计文档
- 需要详细审查报告

调用方式:
1. Main 识别任务需求
2. 将任务路由给 Architect/Reviewer
3. 使用 GLM-4-FlashX 生成长输出
```

---

## 🆘 灾难处理

### GLM-4.7-Flash (2并发/免费)
```
用途:
- 其他模型不可用时的备用
- 成本敏感任务的降级选项
- 非紧急的简单任务

限制:
- 仅2并发，不能作为主力
- 作为安全网存在
```

### 降级策略
```
正常流程:
GLM-5 → GLM-4.6V → GLM-4.5 → GLM-4.7-Flash(备用)

当主力模型不可用时:
1. GLM-5 过载 → 任务排队 或 降级到 GLM-4.6V
2. GLM-4.6V 过载 → 降级到 GLM-4.5
3. 所有模型不可用 → GLM-4.7-Flash 灾难恢复
```

---

## 📊 并发管理

### GLM-5 并发池 (5并发) - 4代理共享
**共享代理**: Architect, Coder, Researcher, Reviewer

**调度优先级**:
```
1. Reviewer (审查阻塞其他工作)
2. Coder (代码生成是核心任务)
3. Architect (设计是前置任务)
4. Researcher (可延后)
```

**过载保护**:
```
当并发达到5时:
- 新任务排队
- 通知用户等待时间
- 可选择降级到 GLM-4.6V 或 GLM-4.5
```

**峰值预测**:
```
典型场景:
- 1个代码生成任务 (Coder)
- 1个架构设计任务 (Architect)
- 1个审查任务 (Reviewer)
→ 约3并发，在5限制内 ✅

高峰场景:
- 2个代码生成任务
- 2个架构任务
- 1个审查任务
→ 约5并发，刚好满载 ⚠️
```

### GLM-4.6V 并发池 (20并发)
**代理**: Analyst

**优势**:
- 单个代理独享20并发
- 可同时处理多个分析任务

### GLM-4.5 并发池 (20并发)
**代理**: Main, Automator

**优势**:
- 2个代理共享20并发
- 充足的并发余量
- 快速响应日常任务

---

## 📂 工作空间结构

```
/workspace/
├── agents/
│   ├── main/              — Main代理 (GLM-4.5)
│   ├── coder/             — Coder代理 (GLM-4.5)
│   ├── architect/         — Architect代理 (GLM-5)
│   ├── automator/         — Automator代理 (GLM-4.5)
│   ├── researcher/        — Researcher代理 (GLM-5)
│   └── analyst/           — Analyst代理 (GLM-4.6V)
├── shared/
│   ├── inbox/
│   ├── specs/
│   ├── artifacts/
│   ├── reviews/
│   └── decisions/
└── tasks/
    ├── QUEUE.md
    └── COMPLETED.md
```

---

## 💰 成本优化

### 主力成本
```
GLM-5 阵营 (4代理):
- Architect: 复杂设计任务
- Coder: 高质量代码生成 ← 升级！
- Researcher: 深度调研任务
- Reviewer: 审查任务
→ 高价值任务，值得投入
→ 注意: 4代理共享5并发

GLM-4.6V 阵营 (1代理):
- Analyst: 视觉分析任务
→ 需要视觉能力

GLM-4.5 阵营 (2代理):
- Main: 协调路由
- Automator: 自动化脚本
→ 日常任务，成本友好
```

### 降级成本
```
GLM-4.7-Flash (免费):
- 仅在灾难时使用
- 2并发限制
- 作为安全网
```

---

## 🚫 反模式警告

1. **❌ 简单任务占用 GLM-5**
   - 简单脚本生成应交给 Automator (GLM-4.5)

2. **❌ GLM-5 过载**
   - 4代理共享5并发，需要监控
   - 高峰期可能需要排队

3. **❌ 非视觉任务用 GLM-4.6V**
   - 视觉模型用于视觉任务

4. **❌ 日常使用 GLM-4.7-Flash**
   - 仅2并发，仅用于灾难处理

5. **❌ 审查自己的工作**
   - Architect 不能审查自己设计的代码

---

## 📈 代理能力矩阵

| 代理 | 模型 | 并发池 | 推理能力 | 专长 |
|------|------|--------|---------|------|
| **Architect** | GLM-5 | 5共享 | ⭐⭐⭐⭐⭐ | 复杂设计 |
| **Coder** | GLM-5 | 5共享 | ⭐⭐⭐⭐⭐ | 高质量代码 |
| **Researcher** | GLM-5 | 5共享 | ⭐⭐⭐⭐⭐ | 深度调研 |
| **Reviewer** | GLM-5 | 5共享 | ⭐⭐⭐⭐⭐ | 质量控制 |
| **Analyst** | GLM-4.6V | 20独享 | ⭐⭐⭐⭐ | 视觉分析 |
| **Automator** | GLM-4.5 | 20共享 | ⭐⭐⭐ | 自动化 |
| **Main** | GLM-4.5 | 20共享 | ⭐⭐⭐ | 快速路由 |

---

*更新时间: 2026-02-17 13:55 GMT+7*
*核心理念: GLM-5用于复杂任务，GLM-4.7-Flash仅用于灾难处理*
